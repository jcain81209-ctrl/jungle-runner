<!DOCTYPE html>
<html>
<head>
<title>Jungle Runner Pro</title>
<style>
body { margin: 0; overflow: hidden; background: black; }
canvas { display: block; margin: auto; background: black; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 800;
canvas.height = 600;

/* =========================
   LOAD IMAGES
========================= */
const roadImg = new Image();
roadImg.src = "assets/road.png";

const treeImg = new Image();
treeImg.src = "assets/tree.png";

const coinImg = new Image();
coinImg.src = "assets/coin.png";

const powerImg = new Image();
powerImg.src = "assets/powerup.png";

/* =========================
   GAME VARIABLES
========================= */
let scrollSpeed = 3;
let roadScroll = 0;
const roadHeight = 10000;

let score = 0;
let shieldActive = false;
let shieldTimer = 0;

/* =========================
   PLAYER
========================= */
let player = {
  lane: 1,
  baseY: 480,
  y: 480,
  width: 60,
  height: 80,
  velocityY: 0,
  gravity: 0.9,
  jumpPower: -20,
  grounded: true
};

/* =========================
   LANE POSITIONS
========================= */
const lanePositions = [250, 400, 550];

/* =========================
   CONTROLS
========================= */
document.addEventListener("keydown", (e) => {
  if (e.code === "ArrowLeft" && player.lane > 0) player.lane--;
  if (e.code === "ArrowRight" && player.lane < 2) player.lane++;
  if (e.code === "Space" && player.grounded) {
    player.velocityY = player.jumpPower;
    player.grounded = false;
  }
});

/* =========================
   OBSTACLES + POWERUPS
========================= */
let obstacles = [];
let items = [];

function spawnObjects() {
  if (Math.random() < 0.03) {
    obstacles.push({
      lane: Math.floor(Math.random() * 3),
      z: 1200
    });
  }

  if (Math.random() < 0.02) {
    items.push({
      lane: Math.floor(Math.random() * 3),
      z: 1200,
      type: Math.random() < 0.5 ? "coin" : "power"
    });
  }
}

/* =========================
   3D PERSPECTIVE DRAW
========================= */
function drawRoad() {

  roadScroll += scrollSpeed;
  if (roadScroll >= roadHeight) roadScroll = 0;

  // Draw road slice
  ctx.drawImage(
    roadImg,
    0,
    roadScroll,
    800,
    600,
    0,
    0,
    800,
    600
  );
}

/* =========================
   UPDATE PLAYER
========================= */
function updatePlayer() {

  player.velocityY += player.gravity;
  player.y += player.velocityY;

  if (player.y >= player.baseY) {
    player.y = player.baseY;
    player.velocityY = 0;
    player.grounded = true;
  }
}

/* =========================
   DRAW PLAYER
========================= */
function drawPlayer() {
  ctx.fillStyle = shieldActive ? "cyan" : "red";
  ctx.fillRect(
    lanePositions[player.lane] - player.width / 2,
    player.y,
    player.width,
    player.height
  );
}

/* =========================
   DRAW OBSTACLES (SCALED)
========================= */
function updateObstacles() {

  obstacles.forEach((obs, index) => {

    obs.z -= scrollSpeed * 4;

    const scale = Math.max(0.3, 1 - obs.z / 1200);
    const size = 120 * scale;

    const x = lanePositions[obs.lane] - size / 2;
    const y = 500 - (obs.z * 0.3);

    ctx.drawImage(treeImg, x, y, size, size);

    // Collision
    if (
      Math.abs(lanePositions[player.lane] - lanePositions[obs.lane]) < 40 &&
      player.y + player.height > y &&
      player.y < y + size
    ) {
      if (!shieldActive) {
        alert("Game Over! Score: " + score);
        document.location.reload();
      }
    }

    if (obs.z <= 0) obstacles.splice(index, 1);
  });
}

/* =========================
   DRAW ITEMS
========================= */
function updateItems() {

  items.forEach((item, index) => {

    item.z -= scrollSpeed * 4;

    const scale = Math.max(0.3, 1 - item.z / 1200);
    const size = 60 * scale;

    const x = lanePositions[item.lane] - size / 2;
    const y = 500 - (item.z * 0.3);

    if (item.type === "coin")
      ctx.drawImage(coinImg, x, y, size, size);
    else
      ctx.drawImage(powerImg, x, y, size, size);

    if (
      Math.abs(lanePositions[player.lane] - lanePositions[item.lane]) < 40 &&
      player.y + player.height > y &&
      player.y < y + size
    ) {
      if (item.type === "coin") score += 10;
      if (item.type === "power") {
        shieldActive = true;
        shieldTimer = 300;
      }
      items.splice(index, 1);
    }

    if (item.z <= 0) items.splice(index, 1);
  });
}

/* =========================
   POWERUP TIMER
========================= */
function updatePower() {
  if (shieldActive) {
    shieldTimer--;
    if (shieldTimer <= 0) shieldActive = false;
  }
}

/* =========================
   UI
========================= */
function drawUI() {
  ctx.fillStyle = "white";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 20, 30);
}

/* =========================
   GAME LOOP
========================= */
function gameLoop() {

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawRoad();
  spawnObjects();
  updatePlayer();
  updateObstacles();
  updateItems();
  updatePower();
  drawPlayer();
  drawUI();

  score += 0.1;

  requestAnimationFrame(gameLoop);
}

roadImg.onload = () => {
  gameLoop();
};
</script>

</body>
</html>
