<!DOCTYPE html>
<html>
<head>
<title>Jungle Runner ULTRA PRO</title>
<style>
body { margin:0; overflow:hidden; background:black; }
canvas { display:block; margin:auto; background:black; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 800;
canvas.height = 600;

/* ======================
   LOAD IMAGES
====================== */
const roadImg = new Image();
roadImg.src = "assets/road.png";

const treeImg = new Image();
treeImg.src = "assets/tree.png";

const coinImg = new Image();
coinImg.src = "assets/coin.png";

const powerImg = new Image();
powerImg.src = "assets/powerup.png";

/* ======================
   GAME SETTINGS
====================== */
let speed = 2;
let maxSpeed = 10;
let roadScroll = 0;
const roadHeight = 10000;
let score = 0;

/* ======================
   PLAYER
====================== */
let player = {
  lane: 1,
  y: 450,
  baseY: 450,
  width: 60,
  height: 90,
  velocityY: 0,
  gravity: 0.9,
  jumpPower: -18,
  grounded: true,
  sliding: false
};

const lanes = [250, 400, 550];

/* ======================
   OBJECT ARRAYS
====================== */
let obstacles = [];
let items = [];
let gaps = [];

/* ======================
   CONTROLS
====================== */
document.addEventListener("keydown", e=>{
  if(e.code==="ArrowLeft" && player.lane>0) player.lane--;
  if(e.code==="ArrowRight" && player.lane<2) player.lane++;
  if(e.code==="Space" && player.grounded){
    player.velocityY = player.jumpPower;
    player.grounded=false;
  }
  if(e.code==="ArrowDown" && !player.sliding){
    player.sliding=true;
    player.height=50;
    setTimeout(()=>{
      player.height=90;
      player.sliding=false;
    },500);
  }
});

/* ======================
   SPAWN SYSTEM
====================== */
function spawn(){
  if(Math.random()<0.03){
    obstacles.push({lane:Math.floor(Math.random()*3), z:1000});
  }
  if(Math.random()<0.02){
    items.push({
      lane:Math.floor(Math.random()*3),
      z:1000,
      type:Math.random()<0.5?"coin":"power"
    });
  }
  if(Math.random()<0.015){
    gaps.push({lane:Math.floor(Math.random()*3), z:1000});
  }
}

/* ======================
   DRAW TRAPEZOID ROAD
====================== */
function drawRoad(){

  roadScroll += speed;
  if(roadScroll >= roadHeight) roadScroll=0;

  // draw slices for perspective
  const slices = 60;
  for(let i=0;i<slices;i++){
    let scale = i/slices;
    let sliceHeight = canvas.height/slices;

    let sourceY = roadScroll + (i*10);
    if(sourceY >= roadHeight) sourceY -= roadHeight;

    let topWidth = 200 + scale*600;
    let x = (canvas.width-topWidth)/2;
    let y = i*sliceHeight;

    ctx.drawImage(
      roadImg,
      0,
      sourceY,
      800,
      10,
      x,
      y,
      topWidth,
      sliceHeight+1
    );
  }
}

/* ======================
   UPDATE PLAYER
====================== */
function updatePlayer(){
  player.velocityY += player.gravity;
  player.y += player.velocityY;

  if(player.y >= player.baseY){
    player.y = player.baseY;
    player.velocityY = 0;
    player.grounded = true;
  }
}

/* ======================
   DRAW PLAYER
====================== */
function drawPlayer(){
  ctx.fillStyle="red";
  ctx.fillRect(
    lanes[player.lane]-player.width/2,
    player.y,
    player.width,
    player.height
  );
}

/* ======================
   UPDATE OBSTACLES
====================== */
function updateObstacles(){

  obstacles.forEach((o,i)=>{
    o.z -= speed*5;

    let depth = 1 - o.z/1000;
    if(depth<0) depth=0;

    let scale = 0.3 + depth*0.7;
    let size = 120*scale;

    let x = lanes[o.lane] - size/2;
    let y = 500 - (o.z*0.4);

    ctx.drawImage(treeImg,x,y,size,size);

    if(
      Math.abs(player.lane-o.lane)===0 &&
      player.y+player.height > y &&
      player.y < y+size
    ){
      alert("Game Over! Score: "+Math.floor(score));
      location.reload();
    }

    if(o.z<=0) obstacles.splice(i,1);
  });
}

/* ======================
   UPDATE GAPS
====================== */
function updateGaps(){
  gaps.forEach((g,i)=>{
    g.z -= speed*5;

    let y = 500 - (g.z*0.4);

    ctx.fillStyle="black";
    ctx.fillRect(lanes[g.lane]-60,y,120,20);

    if(
      Math.abs(player.lane-g.lane)===0 &&
      player.y+player.height>=player.baseY &&
      player.y+player.height>y &&
      player.y<y+20
    ){
      alert("You fell! Score: "+Math.floor(score));
      location.reload();
    }

    if(g.z<=0) gaps.splice(i,1);
  });
}

/* ======================
   UPDATE ITEMS
====================== */
function updateItems(){
  items.forEach((it,i)=>{
    it.z -= speed*5;

    let depth = 1 - it.z/1000;
    let scale = 0.3 + depth*0.7;
    let size = 60*scale;

    let x = lanes[it.lane] - size/2;
    let y = 500 - (it.z*0.4);

    if(it.type==="coin")
      ctx.drawImage(coinImg,x,y,size,size);
    else
      ctx.drawImage(powerImg,x,y,size,size);

    if(
      Math.abs(player.lane-it.lane)===0 &&
      player.y+player.height > y &&
      player.y < y+size
    ){
      if(it.type==="coin") score+=20;
      if(it.type==="power") speed+=1;
      items.splice(i,1);
    }

    if(it.z<=0) items.splice(i,1);
  });
}

/* ======================
   UI
====================== */
function drawUI(){
  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+Math.floor(score),20,30);
  ctx.fillText("Speed: "+speed.toFixed(1),20,55);
}

/* ======================
   GAME LOOP
====================== */
function loop(){

  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawRoad();
  spawn();
  updatePlayer();
  updateObstacles();
  updateGaps();
  updateItems();
  drawPlayer();
  drawUI();

  score += 0.2;
  if(speed<maxSpeed) speed+=0.0005;

  requestAnimationFrame(loop);
}

roadImg.onload=()=>{
  loop();
};
</script>
</body>
</html>
