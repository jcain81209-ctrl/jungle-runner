<!DOCTYPE html>
<html>
<head>
<title>Jungle Runner 3D</title>
<style>
body { margin:0; overflow:hidden; background:black; }
canvas { display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 1280;
canvas.height = 720;

// ===== LOAD IMAGES =====
function load(src){ let i=new Image(); i.src="assets/"+src; return i; }
const bg = load("background.png");
const road = load("road.png");
const playerImg = load("player.png");
const coinImg = load("coin.png");
const treeImg = load("tree.png");
const gapImg = load("gap.png");
const wallImg = load("wall.png");
const magnetImg = load("magnet.png");
const shieldImg = load("shield.png");

// ===== GAME STATE =====
let lane = 1;
let lanes = [-1, 0, 1]; // relative lane positions
let player = { y:0, vy:0, jumping:false, sliding:false };
let baseSpeed = 0.12; // slower
let speed = baseSpeed;
let distance = 0;
let score = 0;
let gameOver = false;
let objects = [];

// ===== SPAWN =====
function spawn(){
    let r = Math.random();
    let type="tree";
    if(r<0.2) type="gap";
    else if(r<0.35) type="wall";
    else if(r<0.5) type="coin";

    objects.push({
        lane: Math.floor(Math.random()*3),
        z: 1.3,
        type:type
    });
}
setInterval(spawn, 1100);

// ===== CONTROLS =====
document.addEventListener("keydown", e=>{
    if(gameOver) location.reload();
    if(e.key==="ArrowLeft" && lane>0) lane--;
    if(e.key==="ArrowRight" && lane<2) lane++;
    if(e.key==="ArrowUp" && !player.jumping){
        player.vy=-0.9; // stronger jump
        player.jumping=true;
    }
    if(e.key==="ArrowDown"){
        player.sliding=true;
        setTimeout(()=>player.sliding=false,600);
    }
});

// ===== UPDATE =====
function update(){
if(gameOver) return;

// Smooth speed increase
speed += 0.000005;
distance += speed;
score = Math.floor(distance*10);

// Jump physics
player.vy += 0.04;
player.y += player.vy;

if(player.y > 0){
    player.y = 0;
    player.jumping = false;
}

// Update objects
objects.forEach((o,i)=>{
    o.z -= speed;

    if(o.z <= 0) objects.splice(i,1);

    if(o.z < 0.15 && o.lane === lane){

        if(o.type === "tree" && player.y > -0.35)
            gameOver = true;

        if(o.type === "gap" && player.y > -0.05)
            gameOver = true;

        if(o.type === "wall" && !player.sliding)
            gameOver = true;

        if(o.type === "coin"){
            score += 200;
            objects.splice(i,1);
        }
    }
});
}

// ===== DRAW =====
function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);

// Background
ctx.drawImage(bg,0,0,canvas.width,canvas.height);

// ===== ROAD PERSPECTIVE =====
let horizonY = canvas.height * 0.42;
let roadBottomWidth = 750;
let roadTopWidth = 250;
let roadHeight = canvas.height - horizonY;

let scroll = (distance * 600) % road.height;

ctx.save();
ctx.beginPath();
ctx.moveTo(canvas.width/2 - roadBottomWidth/2, canvas.height);
ctx.lineTo(canvas.width/2 + roadBottomWidth/2, canvas.height);
ctx.lineTo(canvas.width/2 + roadTopWidth/2, horizonY);
ctx.lineTo(canvas.width/2 - roadTopWidth/2, horizonY);
ctx.closePath();
ctx.clip();

ctx.drawImage(
    road,
    0,
    scroll,
    road.width,
    road.height - scroll,
    canvas.width/2 - roadBottomWidth/2,
    horizonY,
    roadBottomWidth,
    roadHeight
);

ctx.drawImage(
    road,
    0,
    0,
    road.width,
    scroll,
    canvas.width/2 - roadBottomWidth/2,
    horizonY - (scroll * (roadHeight / road.height)),
    roadBottomWidth,
    scroll * (roadHeight / road.height)
);

ctx.restore();

// ===== DRAW OBJECTS =====
objects.sort((a,b)=>b.z-a.z);

objects.forEach(o=>{
    let scale = 1/(o.z*2.2);
    let laneWidthAtZ = roadTopWidth + (roadBottomWidth-roadTopWidth)*(1-o.z);
    let x = canvas.width/2 + lanes[o.lane]*(laneWidthAtZ/3);
    let y = horizonY + (1-o.z)*roadHeight - player.y*250;
    let size = 220*scale;

    let img = treeImg;
    if(o.type==="gap") img=gapImg;
    if(o.type==="wall") img=wallImg;
    if(o.type==="coin") img=coinImg;

    ctx.drawImage(img,x-size/2,y-size/2,size,size);
});

// ===== PLAYER =====
ctx.drawImage(
playerImg,
canvas.width/2-60,
canvas.height*0.75 - player.y*250,
120,
200
);

// UI
ctx.fillStyle="white";
ctx.font="30px Arial";
ctx.fillText("Score: "+score,20,40);

if(gameOver){
ctx.fillStyle="red";
ctx.font="80px Arial";
ctx.fillText("GAME OVER",350,350);
ctx.font="40px Arial";
ctx.fillText("Press Any Key",500,420);
}
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
